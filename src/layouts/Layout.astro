---
import { site, canonicalUrl } from '../config/site';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

interface Props {
  title?: string;
  description?: string;
  keywords?: string; // Changed to string to accept the string from props or site config
}

const { 
  title = site.title,
  description = site.description,
} = Astro.props;

// Use site.keywords array joined by comma if overrides not provided
const keywords = Astro.props.keywords || site.keywords.join(', ');

const canonical = canonicalUrl(Astro.url.pathname);
const ogImageUrl = `${site.canonical}/hero1-colombia.jpg`; // Fixed SEO Image
const faviconUrl = `${site.canonical}/favicon.svg`;

// Schema.org Organization
const organizationSchema = {
  '@context': 'https://schema.org',
  '@type': 'Organization',
  name: 'Flujo TV Colombia',
  url: site.canonical,
  logo: `${site.canonical}/logo_flujo.png`,
  description: site.description,
  contactPoint: {
    '@type': 'ContactPoint',
    telephone: `+${site.whatsappNumber}`,
    contactType: 'customer service',
    availableLanguage: ['es']
  }
};

// Schema.org WebSite
const websiteSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: 'Flujo TV Colombia',
  url: site.canonical,
  description: site.description,
  inLanguage: 'es-CO',
  potentialAction: {
    '@type': 'SearchAction',
    target: `${site.canonical}/?q={search_term_string}`,
    'query-input': 'required name=search_term_string'
  }
};

// Schema.org Product (Streaming Service) - MATCHING GENERIC LANDING QUALITY
const productSchema = {
  '@context': 'https://schema.org',
  '@type': 'Product',
  name: 'Flujo TV Premium Colombia',
  description: site.description,
  image: ogImageUrl,
  url: site.canonical,
  brand: {
    '@type': 'Brand',
    name: 'Flujo TV'
  },
  offers: site.pricing.plans.map(plan => ({
    '@type': 'Offer',
    name: plan.name,
    price: plan.price,
    priceCurrency: site.pricing.currencyCode,
    availability: 'https://schema.org/InStock',
    url: `${site.canonical}/#planes`,
    priceValidUntil: '2026-12-31',
    itemCondition: 'https://schema.org/NewCondition',
    seller: {
      '@type': 'Organization',
      name: 'Flujo TV Colombia'
    },
    shippingDetails: {
      '@type': 'OfferShippingDetails',
      shippingRate: {
        '@type': 'MonetaryAmount',
        value: 0,
        currency: 'USD'
      },
      shippingDestination: {
        '@type': 'DefinedRegion',
        addressCountry: 'CO' // Colombia Target
      },
      deliveryTime: {
        '@type': 'ShippingDeliveryTime',
        handlingTime: {
          '@type': 'QuantitativeValue',
          minValue: 0,
          maxValue: 0,
          unitCode: 'DAY'
        },
        transitTime: {
          '@type': 'QuantitativeValue',
          minValue: 0,
          maxValue: 0,
          unitCode: 'DAY'
        }
      }
    },
    hasMerchantReturnPolicy: {
      '@type': 'MerchantReturnPolicy',
      applicableCountry: 'CO',
      returnPolicyCategory: 'https://schema.org/MerchantReturnNotPermitted',
      merchantReturnDays: 0
    }
  })),
  aggregateRating: {
    '@type': 'AggregateRating',
    ratingValue: '4.9',
    reviewCount: '2150',
    bestRating: '5',
    worstRating: '1'
  }
};

// Schema.org BreadcrumbList
const breadcrumbSchema = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: [
    {
      '@type': 'ListItem',
      position: 1,
      name: 'Inicio',
      item: site.canonical
    }
  ]
};
---

<!doctype html>
<html lang="es-CO">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/png" href="/logo_flujo.png" />
    <meta name="theme-color" content="#06080c" />
    
    <!-- Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://wa.me" />
    
    <!-- SEO Primary Tags -->
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <meta name="author" content={site.author} />
    <meta name="generator" content={Astro.generator} />
    
    <!-- Canonical URL -->
    <link rel="canonical" href={canonical} />
    
    <!-- Robots -->
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    
    <!-- Language & Region -->
    <meta name="language" content="Spanish" />
    <meta name="geo.region" content="CO" />
    <meta name="geo.placename" content="Colombia" />
    <link rel="alternate" hreflang="es-CO" href={canonical} />
    <link rel="alternate" hreflang="x-default" href={canonical} />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonical} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImageUrl} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:locale" content="es_CO" />
    <meta property="og:site_name" content="Flujo TV Colombia" />
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonical} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImageUrl} />
    
    <!-- Structured Data / Schema.org JSON-LD -->
    <script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(productSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
  </head>
  <body class="bg-[#050510] text-white antialiased overflow-x-hidden selection:bg-purple-500/30 selection:text-white">
    <Header />
    <slot />
    <Footer />
  </body>
</html>

<style is:global>
  :root {
    --accent-glow: conic-gradient(from 180deg at 50% 50%, #2a8af6 0deg, #a853ba 180deg, #e92a67 360deg);
  }
  
  html {
    scroll-behavior: smooth;
    font-family: 'Inter', system-ui, sans-serif;
  }

  body {
     min-height: 100vh;
  }

  h1, h2, h3, h4, h5, h6 {
    font-family: 'Outfit', sans-serif;
  }

  /* Custom Scrollbar */
  ::-webkit-scrollbar {
    width: 6px;
  }
  ::-webkit-scrollbar-track {
    background: #050510;
  }
  ::-webkit-scrollbar-thumb {
    background: #33334d;
    border-radius: 10px;
  }
  ::-webkit-scrollbar-thumb:hover {
    background: #4d4d6d;
  }
  
  /* Utilities */
  .text-glow {
    text-shadow: 0 0 20px rgba(255,255,255,0.3);
  }
</style>
